<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			body {
				background-color: #F2F2F2;
			}
			
			.mui-bar {
				z-index: 0;
			}
			
			.mui-bar-nav~.mui-content {
				padding-top: 0px, top:0px
			}
			
			.bartitle {
				display: block;
				overflow: hidden;
				text-overflow: ellipsis;
				text-align: center;
				font-size: 17px;
				font-weight: 500;
				line-height: 44px;
				color: #ffffff;
			}
			
			#titlegride {
				background: #1983D1;
				top: 0px;
				bottom: 0px;
			}
			
			.mui-grid-view.mui-grid-9#titlegride {
				border-top: 0px solid #eee;
				border-left: 0px solid #eee;
				margin-top: 44px;
			}
			
			.mui-grid-view.mui-grid-9 .mui-table-view-cell.title {
				border-right: 1px solid #1983D1;
				border-bottom: 1px solid #1983D1;
			}
			
			.mui-grid-view.mui-grid-9 .mui-table-view-cell.subtitle {
				border-right: 1px solid #CECBCB;
				border-bottom: 1px solid #CECBCB;
			}
			
			#titlegride.mui-table-view.mui-grid-view {
				padding: 0px;
			}
			
			#titlegride.mui-table-view.mui-grid-view .mui-table-view-cell {
				background: inherit;
			}
			
			#titlegride.mui-table-view.mui-grid-view .mui-table-view-cell .mui-media-body {
				color: #ffffff;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h4 id="usernametitle" class="bartitle mui-pull-left" onclick="showMenuOrNot()"></h1>
			    <h4 id="userorg" class="bartitle mui-pull-right"></h1>	
			</header>
			<ul class="mui-table-view mui-grid-view mui-grid-9" id="titlegride">
			<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 title" id="report.html">
			    <a href="#">
			        <img class="mui-media-object" src="../img/wtsb.png" alt="图片" style="width: 40px;height: 40px;"/>
			        <div class="mui-media-body">问题上报</div>
			    </a>
			</li>
			<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 title" id="msg.html">
			    <a href="#">
			        <img class="mui-media-object" src="../img/wtsb.png" alt="图片" style="width: 40px;height: 40px;"/>
			        <div class="mui-media-body">消息中心</div>
			    </a>
			</li>
			<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 title" id="contect.html">
			    <a href="#">
			        <img class="mui-media-object" src="../img/wtsb.png" alt="图片" style="width: 40px;height: 40px;"/>
			        <div class="mui-media-body">通讯录</div>
			    </a>
			</li>
			</ul>
			
			<ul class="mui-table-view mui-grid-view mui-grid-9 content" id="gridcontent">
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="mytask">
					<a href="#">
						<span class="mui-icon mui-icon-home"></span>
						<div class="mui-media-body">我的任务</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="eventlist">
					<a href="#">
						<span class="mui-icon mui-icon-email"><span class="mui-badge mui-badge-red">5</span></span>
						<div class="mui-media-body">事件追踪</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="basicinfo">
					<a href="#">
						<span class="mui-icon mui-icon-chatbubble"></span>
						<div class="mui-media-body">基础信息</div>
					</a>
				</li>
				<div class="firstrowsubtitle">
				</div>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="changelist">
					<a href="#">
						<span class="mui-icon mui-icon-search"></span>
						<div class="mui-media-body">变更记录</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="office.html">
					<a href="#">
						<span class="mui-icon mui-icon-phone"></span>
						<div class="mui-media-body">日常办公</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="wechat.html">
					<a href="#">
						<span class="mui-icon mui-icon-weixin"></span>
						<div class="mui-media-body">即时聊天</div>
					</a>
				</li>
				<div class="secondrowsubtitle"></div>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="friend.html">
					<a href="#">
						<span class="mui-icon mui-icon-chatboxes"></span>
						<div class="mui-media-body">工作圈</div>
					</a>
				</li>
				<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3 subtitle" id="morelist.html" >
					<a href="#">
						<span class="mui-icon mui-icon-plusempty"></span>
						<div class="mui-media-body">更多功能</div>
					</a>
				</li>
			</ul>

		<script src="../js/mui.js"></script>
		<script type="text/javascript">
			var userid;
			var backButtonPress = 0;
			var isChildTitle = false
			mui.init({
			swipeBack: false,
			beforeback: back
			});
			var main,menu, mask = mui.createMask(_closeMenu);
			var showMenu = false;
			function back() {
			if (showMenu) {
				//菜单处于显示状态，返回键应该先关闭菜单,阻止主窗口执行mui.back逻辑；
				closeMenu();
				return false;
			} else {
				//菜单处于隐藏状态，执行返回时，要先close菜单页面，然后继续执行mui.back逻辑关闭主窗口；
				menu.close('none');
				return true;
			}
		}
			//plusReady事件后，自动创建menu窗口；
		mui.plusReady(function() {
			main = plus.webview.currentWebview();
			
			userid = main.userid;
			document.getElementById("usernametitle").innerText = main.username;
			document.getElementById("userorg").innerText = main.org;
			
			//setTimeout的目的是等待窗体动画结束后，再执行create webview操作，避免资源竞争，导致窗口动画不流畅；
			setTimeout(function () {
				//侧滑菜单默认隐藏，这样可以节省内存；
				menu = mui.preload({
					id: 'offcanvas-drag-left-plus-menu',
					url: 'offcanvas-drag-left-plus-menu.html',
					styles: {
						left: 0,
						width: '70%',
						zindex: 9997
					}
				});
			},300);
			
			//添加newId自定义事件监听
			window.addEventListener('items',function(event){
  			//获得事件参数
  			var id = event.detail.id;
  			mui.alert(id);
			});
			
		});
		
		function showMenuOrNot(){
			if(showMenu){
				closeMenu()
			}else{
				openMenu()
			}
		}
		
		/**
		 * 显示菜单菜单
		 */
		function openMenu() {
			if (!showMenu) {
				//侧滑菜单处于隐藏状态，则立即显示出来；
				//显示完毕后，根据不同动画效果移动窗体；
				menu.show('none', 0, function() {
							menu.setStyle({
								left: '0%',
								transition: {
									duration: 300
								}
							});
				});
				//显示遮罩
				mask.show();
				showMenu = true;
			}
		}
		/**
		 * 关闭侧滑菜单
		 */
		function closeMenu () {
			_closeMenu();
			//关闭遮罩
			mask.close();
		}
		
		/**
		 * 关闭侧滑菜单（业务部分）
		 */
		function _closeMenu() {
			if (showMenu) {
				//关闭遮罩；
						//主窗体开始侧滑；
						menu.setStyle({
							left: '-70%',
							transition: {
								duration: 300
							}
						});
				//等窗体动画结束后，隐藏菜单webview，节省资源；
				setTimeout(function() {
					menu.hide();
				}, 200);
				//改变标志位
				showMenu = false;
			}
		}
		
		window.addEventListener('dragright', function(e) {
			e.detail.gesture.preventDefault();
		});
		window.addEventListener('dragleft', function(e) {
			e.detail.gesture.preventDefault();
		});
		 //主界面向右滑动，若菜单未显示，则显示菜单；否则不做任何操作；
		window.addEventListener("swiperight", openMenu);
		 //主界面向左滑动，若菜单已显示，则关闭菜单；否则，不做任何操作；
		window.addEventListener("swipeleft", closeMenu);
		 //menu页面向左滑动，关闭菜单；
		window.addEventListener("menu:swipeleft", closeMenu);
		
		//在主界面点击关闭时，进行页面退出而不是返回上层界面,需要重写back函数
         mui.back = function(){
            	if(backButtonPress > 1) {
					plus.runtime.quit();
				} else {
					plus.nativeUI.toast('再按一次退出应用');
				}
				backButtonPress++;
					
				setTimeout(function() {
					backButtonPress = 0;
				}, 1500);
            }   
        //绑定列表里的子项，点击进入对应 的页面
		mui("#titlegride").on('tap','li',function(){
			
			var toid = this.getAttribute("id");
			mui.openWindow({
				url : toid,
				id  : toid
			});
		})
		var ft = mui(".firstrowsubtitle")[0];
		var st = mui(".secondrowsubtitle")[0];
		var iscollopse = false;//是否展开了二级菜单
		var collopseid = ""//二级菜单相关父菜单的id
		mui("#gridcontent").on('tap','li',function(){
			/*二级菜单点击也会导致一级菜单响应点击，所以只能人为控制*/
			if(isChildTitle){
				isChildTitle = false
				return;
			}
			hiddenOtherBottomLine()
			var toid = this.getAttribute("id");
			if(toid.indexOf("html") > -1){
				mui.openWindow({
					url : toid,
					id  : toid
				});
			}else{
				if(toid === "eventlist"){
					var ids=new Array("tasklist.html","tasklist.html","tasklist.html")
					var values = new Array("待处理案件","待核查关闭","已办案件")
					var casetypes = new Array("0","1","2")
					showSubTitle(toid,ids,values,casetypes,true)
				}
				if(toid === "mytask"){
					var ids=new Array("mytask.html","mytask.html")
					var values = new Array("地址走访","专项走访")
					var casetypes = new Array("0","1")
					showSubTitle(toid,ids,values,casetypes,true)
				}
				if(toid === "basicinfo"){
					var ids=new Array("basicpersonlist.html","basicpersonlist.html","basicpersonlist.html","basicpersonlist.html","basicorglist.html","basicorglist.html","basicorglist.html")
					var values = new Array("实有人口","重点人员","关爱对象","骨干对象","企业组织","重点场所","实有房屋");
					var casetypes = new Array("0","1","2","3","4","5","6")
					showSubTitle(toid,ids,values,casetypes,true)
				}
				if(toid === "changelist"){
					var ids=new Array("deathperson.html","moveperson.html","moveperson.html","moveorg.html","moveorg.html","movehouse.html","movehouse.html")
					var values = new Array("死亡人员","迁入人员","迁出人员","迁入企业","迁出企业","迁入房屋","迁出房屋")
					var casetypes = new Array("0","1","2","1","2","1","2")
					showSubTitle(toid,ids,values,casetypes,false)
				}
			}
		})
		mui(".firstrowsubtitle,.secondrowsubtitle").on('tap','li',function(){
			isChildTitle = true
			var toid = this.getAttribute("id");
			var typet = this.getAttribute("target");
			if(toid.indexOf("html") > -1){
				mui.openWindow({
					url : toid,
					id  : toid,
					extras:{
						htmltype:typet
					}
				})
			}
		})
		
		/**
		 * 添加二级菜单选项
		 * @param {Object} ids 跳转的页面
		 * @param {Object} values 二级菜单名称
		 * @param {Object} types 公用页面，通过传值来区别类型
		 */
		function addSubtitle(ids,values,types){
			var addDocument = '<ul class="mui-table-view mui-grid-view mui-grid-9">';
			for (var i = 0; i < ids.length; i++) {
				addDocument += '<li class="mui-table-view-cell mui-col-xs-4 mui-col-sm-3" id="'+ids[i]+'" target="'+types[i]+'" style="border-right-color: #bbb;background:#cecbcb;font-size:14px;color:#cecbcb><a href="#">'+values[i]+'</a></li>';
			}
			addDocument += '</ul>';
			return addDocument;
		}
		
		/**
		 * 选中/非选中一级菜单时，出现蓝色选中下划线
		 * @param {Object} id
		 * @param {Object} isShow
		 */
		function showBottomLine(id,isShow){
			var clickElemnt = document.getElementById(id)
			if(isShow){
				clickElemnt.style.borderBottomColor="#007AFF"
				clickElemnt.style.borderBottomStyle = "solid"
				clickElemnt.style.borderBottomWidth = "1px"
				collopseid = id
			}else{
				clickElemnt.style.borderBottomWidth = "1px"
				clickElemnt.style.borderBottomColor="#CECBCB"
				clickElemnt.style.borderBottomStyle = "solid"
				collopseid = ""
			}
			iscollopse = isShow
		}
		
		/**
		 * 点击某个一级菜单控制是否展开二级菜单等
		 * @param {Object} id 点击的一级菜单id
		 * @param {Object} ids 跳转页面
		 * @param {Object} values 二级菜单名称
		 * @param {Object} casetypes 二级页面跳转的类型
		 * @param {Object} isfirstrow 是否是第一行要展示的二级菜单
		 */
		function showSubTitle(id,ids,values,casetypes,isfirstrow){
			if(collopseid === id){
				if(iscollopse){
					if(isfirstrow)
						ft.innerHTML = ""
					else
						st.innerHTML = ""
					showBottomLine(id,false)
				}else{
					if(isfirstrow)
						ft.innerHTML = addSubtitle(ids,values,casetypes)
					else
						st.innerHTML = addSubtitle(ids,values,casetypes)
					showBottomLine(id,true)
					iscollopse = true
					collopseid = id
					}
			}else{
				if(isfirstrow)
					ft.innerHTML = addSubtitle(ids,values,casetypes)
				else
					st.innerHTML = addSubtitle(ids,values,casetypes)
				showBottomLine(id,true)
				iscollopse = true
				collopseid = id	
			}			
		}
		
		/**
		 * 隐藏所有的二级菜单
		 * @param {Object} id 一级菜单的id
		 */
		function hiddenOtherBottomLine(id){
			ft.innerHTML = ""
			st.innerHTML = ""
			var elments = mui("#gridcontent>li")
			for (var i = 0; i < elments.length; i++) {
				elments[i].style.borderBottomWidth = "1px"
				elments[i].style.borderBottomColor="#CECBCB"
				elments[i].style.borderBottomStyle = "solid"
			}
		}
		</script>
	</body>

</html>